function t(e){for(var i="",n=0;n<10;n++)i+="0123456789abcdefghjkmnpqrstvwxyz"[32*Math.random()|0];for(var r=i;e[r];)return t(e);return i}var e=function(t){void 0===t&&(t={});var e=t.className;void 0===e&&(e="game");var i=t.width;void 0===i&&(i=1920);var n=t.height;void 0===n&&(n=1080),this.container=document.createElement("div"),this.container.className=e,this.width=i,this.height=n,this.cards=[],this.piles=[],this._uids={},this._cards={},this._moving=[]},i={width:{configurable:!0},height:{configurable:!0}};function n(t,e){var i=t.x,n=t.y,r=t.width,o=t.height,a=e.x,s=e.y,h=e.width,c=e.height;return i+r>=a&&i<=a+h&&n+o>=s&&n<=s+c}i.width.get=function(){return this._width},i.width.set=function(t){this.container.style.width=t+"px",this.container.style.marginLeft=-t/2+"px",this._width=t},i.height.get=function(){return this._height},i.height.set=function(t){this.container.style.height=t+"px",this.container.style.marginTop=-t/2+"px",this._height=t},e.prototype.mountTo=function(t){t.appendChild(this.container)},e.prototype.addDeck=function(t){this.addPile(t)},e.prototype.addPile=function(e){e.game=this,this.piles.push(e);for(var i=0;i<e.cards.length;i++){var n=e.cards[i];n.game=this,n.id=t(this._uids),this.cards.push(n),this._cards[n.id]=n}},e.prototype.pile=function(){!function(t){t.cards.sort((function(e,i){var n=t.getPos(e).z,r=t.getPos(i).z;return n>r?1:r>n?-1:0}))}(this)},e.prototype.onmovestart=function(t){var e=t.card;t.i;e.onmovestart()},e.prototype.onmove=function(t){t.i;var e=t.card,i=t.diff;e.onmove(i)},e.prototype.onmoveend=function(t){t.card.onmoveend()},e.prototype.render=function(t){!function(t){for(var e=t.cards,i=t.container.firstChild,n=0;n<e.length;n++){for(var r=e[n],o=r.graphics,a=o.className;i&&("IMG"!==i.tagName||i.className!==a);){var s=i.nextSibling;i.parentNode.removeChild(i),i=s}i||((i=document.createElement("img")).className=a,i.draggable=!1,t.container.appendChild(i));var h=i,c=r.width,d=r.height,p=r.side,u=o.back,f=o.front,v=t.getRenderPos(r),g=v.x,l=v.y;h.dataset.card=r.id,h.src="back"===p?u:f[r.i],h.width=c,h.height=d,h.style.transform="translate("+Math.round(g)+"px, "+Math.round(l)+"px)",h.style.marginLeft=-c/2+"px",h.style.marginTop=-d/2+"px",i=i.nextSibling}for(;i;){var y=i.nextSibling;i.parentNode.removeChild(i),i=y}}(this)},e.prototype.getCard=function(t){return this._cards[t]},e.prototype.getPos=function(t){var e=t.x,i=t.y,n=t.z,r=t.pile;return r?{x:e+r.x,y:i+r.y,z:n+r.z}:{x:e,y:i,z:n}},e.prototype.getRenderPos=function(t){var e=this.getPos(t),i=e.x,n=e.y,r=e.z;return{x:i-r/4,y:n-r/4}},e.prototype.addMouse=function(){!function(t){t.container.onmousedown=function(e){var i=(e.target.dataset||{}).card;if(i){var n={x:e.pageX,y:e.pageY},r=t.getCard(i);if(r){t.onmovestart({card:r});var o=function(e){var i=e.pageX,o=e.pageY;t.onmove({card:r,diff:{x:i-n.x,y:o-n.y}}),n.x=i,n.y=o},a=function(e){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a),t.onmoveend&&t.onmoveend({card:r})};window.addEventListener("mousemove",o),window.addEventListener("mouseup",a)}}}}(this)},Object.defineProperties(e.prototype,i);var r=function(t){void 0===t&&(t={});var e=t.x;void 0===e&&(e=0);var i=t.y;void 0===i&&(i=0);var n=t.z;void 0===n&&(n=0),this.x=e,this.y=i,this.z=n,this.cards=[]};r.prototype.intersecting=function(t,e){return n(t,e)},r.prototype.moveBack=function(t){},r.prototype.push=function(t){t.pile=this,this.cards.push(t),t.x=t.x-this.x,t.y=t.y-this.y,t.z=this.cards.length},r.prototype.move=function(t){var e=this;this.cards.filter((function(e){return e!==t})).filter((function(i){return e.intersecting(t,i)})).length||this.remove(t)},r.prototype.remove=function(t){for(var e=!1,i=0;i<this.cards.length;i++){var n=this.cards[i];t===n?(t.pile=null,t.x+=this.x,t.y+=this.y,t.z=0,this.cards.splice(i--,1),e=!0):e&&n.z--}};for(var o=new Array(54),a=0;a<o.length;a++)o[a]="standard-deck/front-"+a+".png";var s={className:"standard-card",width:102,height:144,back:"standard-deck/back.png",front:o},h=function(t){void 0===t&&(t={});var e=t.i;void 0===e&&(e=0);var i=t.x;void 0===i&&(i=0);var n=t.y;void 0===n&&(n=0);var r=t.z;void 0===r&&(r=0);var o=t.graphics;void 0===o&&(o=s);var a=t.pile;this.i=e,this.x=i,this.y=n,this.z=r,this.graphics=o,this.pile=a},c={width:{configurable:!0},height:{configurable:!0}};h.prototype.intersecting=function(t){var e=this.game.getPos(this),i=e.x,r=e.y,o=this.game.getPos(t),a=o.x,s=o.y;return n({x:i,y:r,width:t.width,height:t.height},{x:a,y:s,width:t.width,height:t.height})},h.prototype.onmovestart=function(){},h.prototype.onmove=function(t){var e=this,i=e.game;if(e.x+=t.x,e.y+=t.y,e.pile)e.pile.move(e);else{var n=i.cards.filter((function(t){return!t.pile})).filter((function(t){return e!==t})).filter((function(t){return e.intersecting(t)})),r=i.piles.filter((function(t){return t.cards.find((function(t){return e.intersecting(t)}))})).map((function(t){return Object.assign({},t,{z:Math.max.apply(Math,t.cards.map((function(t){return t.z})))})}));e.z=Math.max.apply(Math,[-1].concat(n.concat(r).map((function(t){return t.z}))))+1,i.pile()}},h.prototype.onmoveend=function(){var t=this,e=t.game;if(t.pile)t.pile.moveBack(t);else{var i=e.piles.find((function(e){return e.cards.find((function(e){return t.intersecting(e)}))}));if(i)return i.push(t),void e.pile();var n=e.cards.filter((function(e){return t!==e})).filter((function(t){return!t.pile})).find((function(e){return t.intersecting(e)}));if(n){var o=new r;o.x=n.x,o.y=n.y,o.push(n),o.push(t),e.addPile(o),e.pile()}}},c.width.get=function(){return this.graphics.width},c.height.get=function(){return this.graphics.height},Object.defineProperties(h.prototype,c);var d=function(t){function e(e){var i=this;void 0===e&&(e={});var n=e.graphics;void 0===n&&(n=s),t.call(this,Object.assign({},e,{graphics:n})),this.cards=n.front.map((function(t,e){return new h({graphics:n,pile:i,i:53-e,x:0,y:0,z:e})}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.move=function(t){var e=this;this.cards.filter((function(e){return e!==t})).filter((function(i){return e.intersecting(t,i)})).length||this.remove(t)},e.prototype.moveBack=function(t){t.x=0,t.y=0},e.prototype.push=function(e){t.prototype.push.call(this,e),e.x=0,e.y=0},e}(r),p=new e({width:1920,height:1080}),u=new d({x:960,y:540});p.addDeck(u),p.mountTo(document.body),p.addMouse(),function t(){requestAnimationFrame(t),p.render()}();
